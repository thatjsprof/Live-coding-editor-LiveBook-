{"version":3,"sources":["../node_modules/prettier sync","plugins/fetchPlugin.ts","components/code-editor/code-editor.component.tsx","index.tsx","plugins/unpkg-path-plugin.ts"],"names":["webpackEmptyContext","req","e","Error","code","keys","resolve","module","exports","id","fileCache","localForage","createInstance","name","fetchPlugin","input","setup","build","onLoad","filter","args","a","loader","contents","getItem","path","npmPackage","axios","get","data","request","escaped","replace","returnedPackage","resolveDir","URL","responseURL","pathname","setItem","CodeEditor","initialValue","onChange","EditorRef","useRef","className","onClick","unformatted","current","getModel","getValue","formatted","prettier","format","parser","plugins","useTabs","semi","singleQuote","setValue","onMount","editor","monaco","onDidChangeModelContent","updateOptions","tabSize","value","options","wordWrap","minimap","enabled","showUnused","folding","lineNumbersMinChars","fontSize","scrollBeyondLastLine","automaticLayout","theme","height","language","App","Ref","IframeRef","useState","setInput","entryPoints","bundle","write","onResolve","namespace","href","define","global","result","srcdoc","html","contentWindow","postMessage","outputFiles","text","startService","esBuild","worker","wasmURL","useEffect","target","title","ref","srcDoc","sandbox","ReactDOM","render","document","getElementById"],"mappings":"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","file":"static/js/main.54130ad1.chunk.js","sourcesContent":["function webpackEmptyContext(req) {\n\tvar e = new Error(\"Cannot find module '\" + req + \"'\");\n\te.code = 'MODULE_NOT_FOUND';\n\tthrow e;\n}\nwebpackEmptyContext.keys = function() { return []; };\nwebpackEmptyContext.resolve = webpackEmptyContext;\nmodule.exports = webpackEmptyContext;\nwebpackEmptyContext.id = 49;","import * as esbuild from \"esbuild-wasm\";\nimport axios from \"axios\";\nimport localForage from \"localforage\";\n\nconst fileCache = localForage.createInstance({\n  name: \"livebookCache\",\n});\n\nexport const fetchPlugin = (input: string) => {\n  return {\n    name: \"fetch-plugin\",\n    setup: function (build: esbuild.PluginBuild) {\n      build.onLoad({ filter: /(^index\\.js$)/ }, async (args: any) => {\n        return {\n          loader: \"jsx\",\n          contents: `\n            ${input}\n          `,\n        };\n      });\n\n      build.onLoad({ filter: /.*/ }, async (args: any) => {\n        const npmPackage = await fileCache.getItem<esbuild.OnLoadResult>(\n          args.path\n        );\n\n        if (npmPackage) return npmPackage;\n        return null;\n      });\n\n      build.onLoad({ filter: /.css$/ }, async (args: any) => {\n        const { data, request } = await axios.get(args.path);\n\n        const escaped = data\n          .replace(/\\n/g, \"\")\n          .replace(/\"/g, '\\\\\"')\n          .replace(/'/g, \"\\\\'\");\n\n        const contents = `\n            const style = document.createElement('style');\n            style.innerText = '${escaped}';\n            document.head.appendChild('style');\n        `;\n\n        const returnedPackage: esbuild.OnLoadResult = {\n          loader: \"jsx\",\n          contents,\n          resolveDir: new URL(\"./\", request.responseURL).pathname,\n        };\n\n        await fileCache.setItem(args.path, returnedPackage);\n\n        return returnedPackage;\n      });\n\n      build.onLoad({ filter: /.*/ }, async (args: any) => {\n        const { data, request } = await axios.get(args.path);\n\n        const returnedPackage: esbuild.OnLoadResult = {\n          loader: \"jsx\",\n          contents: data,\n          resolveDir: new URL(\"./\", request.responseURL).pathname,\n        };\n\n        await fileCache.setItem(args.path, returnedPackage);\n\n        return returnedPackage;\n      });\n    },\n  };\n};\n","import React, { useRef } from \"react\";\nimport MonacoEditor, { OnMount } from \"@monaco-editor/react\";\nimport prettier from \"prettier\";\nimport parser from \"prettier/parser-babel\";\nimport \"./code-editor.styles.css\";\n\ntype WithChildren<T = {}> = T & { children?: React.ReactNode };\n\ntype CodeEditorProps = WithChildren<{\n  initialValue: string;\n  onChange: (value: string) => void;\n}>;\n\nconst CodeEditor = ({ initialValue, onChange }: CodeEditorProps) => {\n  const EditorRef = useRef<any>();\n\n  const onEditorDidMount: OnMount = (editor, monaco) => {\n    EditorRef.current = editor;\n    editor.onDidChangeModelContent(() => {\n      onChange(editor.getValue());\n    });\n    editor.getModel()?.updateOptions({ tabSize: 2 });\n  };\n\n  const formatCode = () => {\n    const unformatted = EditorRef.current.getModel().getValue();\n    const formatted = prettier\n      .format(unformatted, {\n        parser: \"babel\",\n        plugins: [parser],\n        useTabs: false,\n        semi: true,\n        singleQuote: true,\n      })\n      .replace(/\\n$/, \"\");\n    EditorRef.current.setValue(formatted);\n  };\n\n  return (\n    <div className=\"editor-wrapper\">\n      <button\n        className=\"button button-format is-primary is-small\"\n        onClick={formatCode}\n      >\n        Format Code\n      </button>\n      <MonacoEditor\n        onMount={onEditorDidMount}\n        value={initialValue}\n        options={{\n          wordWrap: \"on\",\n          minimap: { enabled: false },\n          showUnused: false,\n          folding: false,\n          lineNumbersMinChars: 3,\n          fontSize: 16,\n          scrollBeyondLastLine: false,\n          automaticLayout: true,\n        }}\n        theme=\"vs-dark\"\n        height=\"500px\"\n        language=\"javascript\"\n      />\n    </div>\n  );\n};\n\nexport default CodeEditor;\n","import 'bulmaswatch/superhero/bulmaswatch.min.css'\nimport * as esBuild from \"esbuild-wasm\";\nimport { useState, useEffect, useRef } from \"react\";\nimport ReactDOM from \"react-dom\";\nimport { unpkgPathPlugin } from \"./plugins/unpkg-path-plugin\";\nimport { fetchPlugin } from \"./plugins/fetchPlugin\";\nimport CodeEditor from \"./components/code-editor/code-editor.component\";\n\nconst App = () => {\n  const Ref = useRef<any>();\n  const IframeRef = useRef<any>(\"\");\n  const [input, setInput] = useState(\"\");\n\n  const onClick = async () => {\n    if (!Ref.current) return;\n    const result = await Ref.current.build({\n      entryPoints: [\"index.js\"],\n      bundle: true,\n      write: false,\n      plugins: [unpkgPathPlugin(), fetchPlugin(input)],\n      define: {\n        \"process.env.NODE_ENV\": '\"production\"',\n        global: \"window\",\n      },\n    });\n\n    IframeRef.current.srcdoc = html;\n\n    IframeRef.current.contentWindow.postMessage(\n      result.outputFiles[0].text,\n      \"*\"\n    );\n  };\n\n  const html = `\n  <html>\n    <head></head>\n    <body>\n      <div id=\"root\"></div>\n      <script>\n        window.addEventListener('message', (event) => {\n          try {\n            eval(event.data)\n          } catch (err) {\n            document.querySelector('#root').innerHTML = '<div style=\"color: red;\"><h4>Runtime Error:</h4>' + err + '</div>';\n            console.error(err);\n          }\n        }, false)\n       </script>\n    </body>\n  </html>\n  `;\n\n  const startService = async () => {\n    Ref.current = await esBuild.startService({\n      worker: true,\n      wasmURL: \"https://unpkg.com/esbuild-wasm@0.8.57/esbuild.wasm\",\n    });\n  };\n\n  useEffect(() => {\n    startService();\n  }, []);\n\n  return (\n    <div>\n      <CodeEditor initialValue=\"const a = 1;\" onChange={(value) => setInput(value)} />\n      <textarea\n        value={input}\n        onChange={(e) => {\n          setInput(e.target.value);\n        }}\n      ></textarea>\n      <div>\n        <button onClick={onClick}>Submit</button>\n      </div>\n      <iframe\n        title=\"preview\"\n        ref={IframeRef}\n        srcDoc={html}\n        sandbox=\"allow-scripts\"\n      ></iframe>\n    </div>\n  );\n};\n\nReactDOM.render(<App />, document.getElementById(\"root\"));\n","import * as esbuild from \"esbuild-wasm\";\n\nexport const unpkgPathPlugin = () => {\n  return {\n    name: \"unpkg-path-plugin\",\n    setup(build: esbuild.PluginBuild) {\n      // Handle root index.js file\n      build.onResolve({ filter: /(^index\\.js$)/ }, async (args: any) => {\n        return { path: \"index.js\", namespace: \"a\" };\n      });\n\n      //   Handle relative file imports\n      build.onResolve({ filter: /^\\.+\\// }, async (args: any) => {\n        return {\n          namespace: \"a\",\n          path: new URL(`${args.path}`, `https://unpkg.com/${args.resolveDir}/`)\n            .href,\n        };\n      });\n\n      //   Handle main file of a module\n      build.onResolve({ filter: /.*/ }, async (args: any) => {\n        return {\n          namespace: \"a\",\n          path: `https://unpkg.com/${args.path}`,\n        };\n      });\n    },\n  };\n};\n"],"sourceRoot":""}